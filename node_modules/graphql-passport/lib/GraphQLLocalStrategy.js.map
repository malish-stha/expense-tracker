{"version":3,"file":"GraphQLLocalStrategy.js","names":["_passportStrategy","require","GraphQLLocalStrategy","PassportStrategy","constructor","options","verify","passReqToCallback","TypeError","name","authenticate","req","username","email","password","done","err","user","info","error","fail","success","_default","exports","default"],"sources":["../src/GraphQLLocalStrategy.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport { Strategy as PassportStrategy } from 'passport-strategy';\nimport { Request as ExpressRequest } from 'express';\nimport { PassportContext, InfoArgument } from './types';\n\ntype DoneFn = (error: any, user?: any, info?: InfoArgument) => void;\ntype VerifyFn = (username: unknown, password: unknown, done: DoneFn) => void;\ntype VerifyFnWRequest = <U extends {}, Request extends object = ExpressRequest>(\n  req: Request | PassportContext<U, Request>,\n  username: unknown,\n  password: unknown,\n  done: DoneFn,\n) => void;\n\ninterface GraphQLLocalStrategyOptions {\n  passReqToCallback?: boolean;\n}\n\ninterface GraphQLLocalStrategyOptionsWithRequest extends GraphQLLocalStrategyOptions {\n  passReqToCallback: true;\n}\n\ninterface GraphQLLocalStrategyOptionsWithoutRequest extends GraphQLLocalStrategyOptions {\n  passReqToCallback?: false;\n}\n\nclass GraphQLLocalStrategy<U extends {}, Request extends ExpressRequest = ExpressRequest> extends PassportStrategy {\n  constructor(verify: VerifyFn);\n  constructor(options: GraphQLLocalStrategyOptionsWithoutRequest, verify: VerifyFn);\n  constructor(options: GraphQLLocalStrategyOptionsWithRequest, verify: VerifyFnWRequest);\n  constructor(\n    options?: GraphQLLocalStrategyOptions | VerifyFn | VerifyFnWRequest,\n    verify?: VerifyFn | VerifyFnWRequest,\n  ) {\n    super();\n\n    if (typeof options === 'function') {\n      this.verify = options;\n      this.passReqToCallback = false;\n    } else {\n      this.verify = verify;\n      this.passReqToCallback = options.passReqToCallback;\n    }\n    if (!this.verify) {\n      throw new TypeError('GraphQLLocalStrategy requires a verify callback');\n    }\n\n    this.name = 'graphql-local';\n  }\n\n  verify: VerifyFn | VerifyFnWRequest;\n\n  passReqToCallback: boolean | undefined;\n\n  name: string;\n\n  authenticate(req: Request, options: { username?: string; email?: string; password: string }) {\n    const { username, email, password } = options;\n\n    const done = (err: Error, user: U, info?: InfoArgument) => {\n      if (err) {\n        return this.error(err);\n      }\n      if (!user) {\n        return this.fail(info, 401);\n      }\n      return this.success(user, info);\n    };\n\n    if (this.passReqToCallback) {\n      // @ts-ignore - not sure how tow handle this nicely in TS\n      this.verify(req, username || email, password, done);\n    } else {\n      // @ts-ignore - not sure how tow handle this nicely in TS\n      this.verify(username || email, password, done);\n    }\n  }\n}\n\nexport default GraphQLLocalStrategy;\n"],"mappings":";;;;;;AACA,IAAAA,iBAAA,GAAAC,OAAA;AADA;;AA0BA,MAAMC,oBAAoB,SAAwEC,0BAAgB,CAAC;EAIjHC,WAAWA,CACTC,OAAmE,EACnEC,MAAoC,EACpC;IACA,KAAK,CAAC,CAAC;IAEP,IAAI,OAAOD,OAAO,KAAK,UAAU,EAAE;MACjC,IAAI,CAACC,MAAM,GAAGD,OAAO;MACrB,IAAI,CAACE,iBAAiB,GAAG,KAAK;IAChC,CAAC,MAAM;MACL,IAAI,CAACD,MAAM,GAAGA,MAAM;MACpB,IAAI,CAACC,iBAAiB,GAAGF,OAAO,CAACE,iBAAiB;IACpD;IACA,IAAI,CAAC,IAAI,CAACD,MAAM,EAAE;MAChB,MAAM,IAAIE,SAAS,CAAC,iDAAiD,CAAC;IACxE;IAEA,IAAI,CAACC,IAAI,GAAG,eAAe;EAC7B;EAQAC,YAAYA,CAACC,GAAY,EAAEN,OAAgE,EAAE;IAC3F,MAAM;MAAEO,QAAQ;MAAEC,KAAK;MAAEC;IAAS,CAAC,GAAGT,OAAO;IAE7C,MAAMU,IAAI,GAAGA,CAACC,GAAU,EAAEC,IAAO,EAAEC,IAAmB,KAAK;MACzD,IAAIF,GAAG,EAAE;QACP,OAAO,IAAI,CAACG,KAAK,CAACH,GAAG,CAAC;MACxB;MACA,IAAI,CAACC,IAAI,EAAE;QACT,OAAO,IAAI,CAACG,IAAI,CAACF,IAAI,EAAE,GAAG,CAAC;MAC7B;MACA,OAAO,IAAI,CAACG,OAAO,CAACJ,IAAI,EAAEC,IAAI,CAAC;IACjC,CAAC;IAED,IAAI,IAAI,CAACX,iBAAiB,EAAE;MAC1B;MACA,IAAI,CAACD,MAAM,CAACK,GAAG,EAAEC,QAAQ,IAAIC,KAAK,EAAEC,QAAQ,EAAEC,IAAI,CAAC;IACrD,CAAC,MAAM;MACL;MACA,IAAI,CAACT,MAAM,CAACM,QAAQ,IAAIC,KAAK,EAAEC,QAAQ,EAAEC,IAAI,CAAC;IAChD;EACF;AACF;AAAC,IAAAO,QAAA,GAEcpB,oBAAoB;AAAAqB,OAAA,CAAAC,OAAA,GAAAF,QAAA"}