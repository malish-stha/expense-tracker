{"version":3,"file":"createSubscriptionOnConnect.js","names":["executeMiddlewares","middlewares","webSocket","resolve","length","upgradeReq","req","nextMiddleware","remainingMiddlewares","slice","response","createSubscriptionOnConnect","onConnect","connectionParams","Promise","_default","exports","default"],"sources":["../src/createSubscriptionOnConnect.ts"],"sourcesContent":["import { Response } from 'express';\nimport { WebSocket } from './types';\n\ntype MiddlewareFns = (req: WebSocket['upgradeReq'], res: Response, resolve: (r: { req: WebSocket }) => unknown) => void;\ninterface ReturnOnConnect {\n  req: WebSocket['upgradeReq'];\n}\n\nconst executeMiddlewares = (\n  middlewares: MiddlewareFns[],\n  webSocket: WebSocket,\n  resolve: (value: ReturnOnConnect | PromiseLike<ReturnOnConnect>) => void,\n) => {\n  if (middlewares.length === 0) {\n    const { upgradeReq } = webSocket;\n    resolve({ req: upgradeReq });\n  } else {\n    const nextMiddleware = middlewares[0];\n    const remainingMiddlewares = middlewares.slice(1);\n    const response = {} as Response;\n    nextMiddleware(webSocket.upgradeReq, response, () => executeMiddlewares(remainingMiddlewares, webSocket, resolve));\n  }\n};\n\nconst createSubscriptionOnConnect = <T extends ReturnOnConnect>(middlewares: MiddlewareFns[]) => {\n  // This is called on each message that has a GQL_CONNECTION_INIT message type\n  const onConnect = (connectionParams: Object, webSocket: WebSocket) =>\n    new Promise<T>((resolve) => executeMiddlewares(middlewares, webSocket, resolve));\n\n  return onConnect;\n};\n\nexport default createSubscriptionOnConnect;\n"],"mappings":";;;;;;AAQA,MAAMA,kBAAkB,GAAGA,CACzBC,WAA4B,EAC5BC,SAAoB,EACpBC,OAAwE,KACrE;EACH,IAAIF,WAAW,CAACG,MAAM,KAAK,CAAC,EAAE;IAC5B,MAAM;MAAEC;IAAW,CAAC,GAAGH,SAAS;IAChCC,OAAO,CAAC;MAAEG,GAAG,EAAED;IAAW,CAAC,CAAC;EAC9B,CAAC,MAAM;IACL,MAAME,cAAc,GAAGN,WAAW,CAAC,CAAC,CAAC;IACrC,MAAMO,oBAAoB,GAAGP,WAAW,CAACQ,KAAK,CAAC,CAAC,CAAC;IACjD,MAAMC,QAAQ,GAAG,CAAC,CAAa;IAC/BH,cAAc,CAACL,SAAS,CAACG,UAAU,EAAEK,QAAQ,EAAE,MAAMV,kBAAkB,CAACQ,oBAAoB,EAAEN,SAAS,EAAEC,OAAO,CAAC,CAAC;EACpH;AACF,CAAC;AAED,MAAMQ,2BAA2B,GAA+BV,WAA4B,IAAK;EAC/F;EACA,MAAMW,SAAS,GAAGA,CAACC,gBAAwB,EAAEX,SAAoB,KAC/D,IAAIY,OAAO,CAAKX,OAAO,IAAKH,kBAAkB,CAACC,WAAW,EAAEC,SAAS,EAAEC,OAAO,CAAC,CAAC;EAElF,OAAOS,SAAS;AAClB,CAAC;AAAC,IAAAG,QAAA,GAEaJ,2BAA2B;AAAAK,OAAA,CAAAC,OAAA,GAAAF,QAAA"}